#! /usr/bin/env python

"""
Extract features of DNN activation
"""

import argparse


def main():
    parser = argparse.ArgumentParser(description='Extract features of DNN activation')
    parser.add_argument('-act',
                        metavar='Activation hd5 file',
                        required=True,
                        type=str,
                        help='DNN activation hd5 file')
    parser.add_argument('-layer',
                        metavar='Layer',
                        type=str,
                        nargs='+',
                        help="Layers of interest to do feature extraxtion. "
                             "E.g., 'conv1' represents the first convolution layer,  "
                             "and 'fc1' represents the first full connection layer. "
                             "Default is to do feature for all layers "
                             "in the activation file.")
    parser.add_argument('-meth',
                        metavar='Method',
                        required=True,
                        type=str,
                        choices=('pca', 'hist', 'psd'),
                        help='Feature extraction method: '
                             'hist: use histogram of activation as feature; '
                             'psd: use power spectral density as feature; '
                             'pca: use some principal components as features. (used with option -npc)')
# as max and mean pooling already supported in dnn_pooling, we don't it here again. 
    parser.add_argument('-axis',
                        metavar='Axis',
                        type=str,
                        choices=('channel', 'column'),
                        help='axis for feature extraction '
                             'Default is extracting features from the whole layer.')
#    parser.add_argument('-npc',
#                        metavar='#PrincipalComponents',
#                        type=int,
#                        help="the number of principal components. (be used when -meth is 'pca')"
# I suggest move -npc to -meth, such as -meth pca 10, -meth hist 20.  

    parser.add_argument('-out',
                        metavar='Output hd5 file',
                        required=True,
                        type=str,
                        help='Output filename with suffix .act.h5')
    args = parser.parse_args()


if __name__ == '__main__':
    main()
